@page "/watchlist"
@using System.Text.Json

<PageTitle>Watchlist</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Flights Watchlist</MudText>
<MudText Class="mb-8">Add or remove flights that you want to track</MudText>

@if (flights == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
    <MudTable Items="flights" Hover="true" Breakpoint="Breakpoint.Sm">
        <HeaderContent>
            <MudTh>Date</MudTh>
            <MudTh>Flight Number</MudTh>
            <MudTh>Departure</MudTh>
            <MudTh>Arrival</MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Date">@context.FlightDepartureTime.Date.ToString("d")</MudTd>
            <MudTd DataLabel="Flight Number">@context.FlightNumber</MudTd>
            <MudTd DataLabel="Departure">@context.Origin.Name</MudTd>
            <MudTd DataLabel="Arrival">@context.Destination.Name</MudTd>
            <MudTd>
                <MudIconButton Icon="@Icons.Material.Filled.QueryStats"></MudIconButton>
                <MudIconButton Icon="@Icons.Material.Filled.Settings"></MudIconButton>
            </MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    private HttpClient Http = new HttpClient();
    private List<FlightDTO>? flights = new List<FlightDTO>();

    protected override async Task OnInitializedAsync() => await GetFlights();

    private async Task GetFlights() {
        var response = await Http.GetAsync("https://localhost:7019/api/Flights");
        if (response.IsSuccessStatusCode) {
            var content = await response.Content.ReadAsStringAsync();
            flights = JsonSerializer.Deserialize<List<FlightDTO>>(content, new JsonSerializerOptions{PropertyNameCaseInsensitive = true});
            foreach (FlightDTO flight in flights){
                Console.WriteLine(flight.FlightNumber);
            }
        } else {
            Console.WriteLine(response.StatusCode);
        }
    }
}
